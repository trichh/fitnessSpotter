var fitnessSpotter=angular.module("fitnessSpotter",["ngRoute","ngAnimate","cloudinary","ngFileUpload"]);angular.module("fitnessSpotter").config(["$routeProvider","$locationProvider",function(e,o){o.html5Mode(!0),e.when("/",{templateUrl:"views/home.html"}).when("/register",{templateUrl:"views/register.html",controller:"RegisterCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/admin/:gymName/add-client",{templateUrl:"views/addClient.html",controller:"NewClientCtrl"}).when("/admin/:gymName/dashboard",{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).when("/admin/:gymName/edit",{templateUrl:"views/editUser.html",controller:"EditUserCtrl"}).when("/admin/:gymName/:clientId/profile",{templateUrl:"views/profile.html",controller:"ProfileCtrl"}).when("/admin/:gymName/:clientId/edit",{templateUrl:"views/editClient.html",controller:"EditClientCtrl"}).otherwise("/")}]).run(["$rootScope","$http",function(e,o){e.logout=function(){o.post("/logout")}}]),angular.module("fitnessSpotter").controller("DashboardCtrl",["$scope","$location","$http",function(e,o,a){a.get("/api/dashboard").then(function(o){console.log("SESSION DATA:",o.data.sessionData.passport.user),console.log("CLIENT DATA:",o.data.clientData),e.gymName=o.data.sessionData.passport.user.gymName,e.profilePicture=o.data.sessionData.passport.user.profilePicture,e.clients=o.data.clientData;var a=o.data.sessionData.passport.user.gymName;a=a.replace(/\s+/g,"-").toLowerCase(),e.dashboardRoute=a})["catch"](function(e){console.log(e)})}]),angular.module("fitnessSpotter").controller("EditClientCtrl",["$scope","$location","$http","$q","$routeParams",function(e,o,a,t,i){var r=t.defer();a.get("/api/editClient").then(function(o){var a=o.data.sessionData.passport.user.gymName;a=a.replace(/\s+/g,"-").toLowerCase(),e.dashboardRoute=a})["catch"](function(e){console.log(e)}),e.editClient=function(){a.get("/api/editClient",{params:{gymName:i.gymName,clientId:i.clientId}}).then(function(o){e.oldName=o.data.clientData[0].name,e.oldWeight=o.data.clientData[0].weight,e.oldProfilePic=o.data.clientData[0].profilePicture,e.oldWorkoutPlan=o.data.clientData[0].workoutPlan,e.oldMealPlan=o.data.clientData[0].mealPlan,e.oldAssessment=o.data.clientData[0].clientAssessment,r.resolve()}),r.promise.then(function(){if(void 0===e.fullName)var o=e.oldName;else if(void 0!==typeof e.fullName)var o=e.fullName;if(void 0===e.weight)var t=e.oldWeight;else if(void 0!==typeof e.weight)var t=e.weight;if(void 0===e.photo)var r=e.oldProfilePic;else if(void 0!==typeof e.photo)var r=e.photo;if(void 0===e.workoutPlan)var l=e.oldWorkoutPlan;else if(void 0!==typeof e.workoutPlan)var l=e.workoutPlan;if(void 0===e.mealPlan)var s=e.oldMealPlan;else if(void 0!==typeof e.mealPlan)var s=e.mealPlan;if(void 0===e.clientAssessment)var n=e.oldAssessment;else if(void 0!==typeof e.clientAssessment)var n=e.clientAssessment;a.post("/api/updateClient",{_id:i.clientId,name:o,weight:t,profilePicture:r,workoutPlan:l,mealPlan:s,clientAssessment:n}).then(function(e){console.log("COMING BACK: ",e)})})}}]),angular.module("fitnessSpotter").controller("EditUserCtrl",["$scope","$location","$http","$q",function(e,o,a,t){var i=t.defer();e.uploadImage=function(o){e.files=o,e.files&&angular.forEach(o,function(o){o&&!o.$error&&(o.upload=$upload.upload({url:"https://api.cloudinary.com/v1_1/"+cloudinary.config().cloud_name+"/upload",data:{upload_preset:cloudinary.config().upload_preset,tags:"myphotoalbum",file:o}}).success(function(a,t,i,r){o.result=a;var l=a.url;e.photo=l}).error(function(e,a,t,i){o.result=e}))})},a.get("/api/editUser").then(function(o){var a=o.data.sessionData.passport.user.gymName;a=a.replace(/\s+/g,"-").toLowerCase(),e.dashboardRoute=a})["catch"](function(e){console.log(e)}),e.editUser=function(){a.get("/api/editUser").then(function(o){e.oldEmail=o.data.sessionData.passport.user.email,e.oldPassword=o.data.sessionData.passport.user.password,e.oldName=o.data.sessionData.passport.user.gymName,e.oldProfilePic=o.data.sessionData.passport.user.profilePicture,e.oldNumber=o.data.sessionData.passport.user.phoneNumber,e.oldPlan=o.data.sessionData.passport.user.paymentPlan,e.oldCardName=o.data.sessionData.passport.user.cardHolder,e.oldCardNumber=o.data.sessionData.passport.user.cardNumber,e.oldSecurityCode=o.data.sessionData.passport.user.securityCode,e.oldMonth=o.data.sessionData.passport.user.month,e.oldYear=o.data.sessionData.passport.user.year,i.resolve()}),i.promise.then(function(){if(void 0===e.email)var o=e.oldEmail;else if(void 0!==typeof e.email)var o=e.email;if(void 0===e.password)var t=e.oldPassword;else if(void 0!==typeof e.password)var t=e.password;if(void 0===e.name)var i=e.oldName;else if(void 0!==typeof e.name)var i=e.name;if(void 0===e.photo)var r=e.oldProfilePic;else if(void 0!==typeof e.photo)var r=e.photo;if(void 0===e.number)var l=e.oldNumber;else if(void 0!==typeof e.number)var l=e.number;if(void 0===e.basic&&void 0===e.plus&&void 0===e.premium)var s=e.oldPlan;else if(void 0!==typeof e.basic||void 0!==typeof e.plus||void 0!==typeof e.premium)if(void 0!==typeof e.basic&&void 0===e.plus&&void 0===e.premium)var s=e.basic;else if(void 0!==typeof e.plus&&void 0===e.basic&&void 0===e.premium)var s=e.plus;else if(void 0!==typeof e.premium&&void 0===e.basic&&void 0===e.plus)var s=e.premium;if(void 0===e.cardName)var n=e.oldCardName;else if(void 0!==typeof e.cardName)var n=e.cardName;if(void 0===e.cardNumber)var d=e.oldCardNumber;else if(void 0!==typeof e.cardNumber)var d=e.cardNumber;if(void 0===e.securityCode)var c=e.oldSecurityCode;else if(void 0!==typeof e.securityCode)var c=e.securityCode;if(void 0===e.month)var p=e.oldMonth;else if(void 0!==typeof e.month)var p=e.month;if(void 0===e.year)var u=e.oldYear;else if(void 0!==typeof e.year)var u=e.year;a.post("/api/updateUser",{email:o,password:t,gymName:i,profilePicture:r,phoneNumber:l,paymentPlan:s,cardHolder:n,cardNumber:d,securityCode:c,month:p,year:u}).then(function(e){console.log("COMING BACK: ",e)})})},e["delete"]=function(){a.get("/api/deleteUser").then(function(e){console.log("CLIENT DELETED",e)})["catch"](function(e){console.log(e)})}}]),angular.module("fitnessSpotter").controller("LoginCtrl",["$rootScope","$scope","$location","$http",function(e,o,a,t){o.login=function(){var e=o.email,i=o.password;t.post("/api/login",{email:e,password:i}).success(function(e){var o=e.passport.user.gymName;o=o.replace(/\s+/g,"-").toLowerCase(),a.path("/admin/"+o+"/dashboard"),console.log("Authentication successful!")}).error(function(e){console.log("Authentication unsuccessful!",e),a.path("/")})}}]),angular.module("fitnessSpotter").controller("NewClientCtrl",["$scope","$location","$http",function(e,o,a){a.get("/api/add-client").then(function(o){var a=o.data.sessionData.passport.user.gymName;a=a.replace(/\s+/g,"-").toLowerCase(),e.dashboardRoute=a})["catch"](function(e){console.log(e)}),e.addClient=function(){var o=e.fullName,t=e.weight,i=e.photo,r=e.workoutPlan,l=e.mealPlan,s=e.clientAssessment;a.post("/api/add-client",{name:o,weight:t,profilePicture:i,workoutPlan:r,mealPlan:l,clientAssessment:s}).then(function(e){console.log("COMING BACK: ",e)})}}]),angular.module("fitnessSpotter").controller("ProfileCtrl",["$scope","$location","$http","$routeParams",function(e,o,a,t){a.get("/api/clientData",{params:{gymName:t.gymName,clientId:t.clientId}}).then(function(o){console.log("DATA SENT:",o.data.clientData),e.clients=o.data.clientData})["catch"](function(e){console.log(e)}),a.get("/api/profile").then(function(o){var a=o.data.sessionData.passport.user.gymName;a=a.replace(/\s+/g,"-").toLowerCase(),e.dashboardRoute=a})["catch"](function(e){console.log(e)}),e["delete"]=function(){a.get("/api/deleteClient",{params:{gymName:t.gymName,clientId:t.clientId}}).then(function(e){console.log("CLIENT DELETED",e)})["catch"](function(e){console.log(e)})}}]),angular.module("fitnessSpotter").controller("RegisterCtrl",["$scope","$location","$http",function(e,o,a){e.register=function(){var o=e.email,t=e.password,i=e.name,r=e.photo,l=e.number,s=e.basic,n=e.plus,d=e.premium,c=e.cardName,p=e.cardNumber,u=e.securityCode,m=e.month,f=e.year;if(void 0!==typeof s&&void 0===n&&void 0===d)var v=s;else if(void 0!==typeof n&&void 0===s&&void 0===d)var v=n;else if(void 0!==typeof d&&void 0===s&&void 0===n)var v=d;a.post("/api/register",{email:o,password:t,gymName:i,profilePicture:r,phoneNumber:l,paymentPlan:v,cardHolder:c,cardNumber:p,securityCode:u,month:m,year:f}).then(function(e){console.log("COMING BACK: ",e)}),e.email="",e.password="",e.name="",e.number="",e.basic="",e.plus="",e.premium="",e.cardName="",e.cardNumber="",e.securityCode="",e.month="",e.year=""}}]);